#tutorial 1 = preprocessing 
module load fastqc
mkdir preprocessing_data

#copy direcotry contents and moved to mine
cp -r /home/knightsd/public/mice5035/2024/host_removed/ /users/7/wrig1125/project/

fastqc -o preprocessing_data /users/7/wrig1125/project/host_removed/*.fastq.gz
#quality is around 30 

module load python/3.6.3
#load in shi7
python3 /home/knightsd/public/shi7/shi7.py -h
#command interface for shi7 because this pathway is where it is located 

python3 /home/knightsd/public/shi7/shi7.py -i /users/7/wrig1125/project/host_removed/ -o preprocessing_data/trimmed_reads --filter_qual 30 --combine_fasta false
#making sure it worked 
ls -l preprocessing_data/trimmed_reads 
#SUCCESS YAY

#looking inside the files 
less preprocessing_data/trimmed_reads/shi7.log

#tutorial 2 = 16S feature extraction 
   module load qiime/1.9.1_centos7
   module load bowtie2

grep ">" /users/7/wrig1125/preprocessing_data/trimmed_reads/*.fna | cut -f 1 -d "_" | sort | uniq | wc

ls /users/7/wrig1125/preprocessing_data/trimmed_reads/*.fna
#verifying the files are there 

#OTU CLOSED reference picking ( most similar ) 
#this code below didnt work and i am so mad ugh
python /home/knightsd/public/mice5035/NINJA-OPS-1.5.1/bin/ninja.py -i /users/7/wrig1125/preprocessing_data/trimmed_reads/*.fna -o otus -p 4 -z -m normal

#ran this and it worked 
for file in /users/7/wrig1125/preprocessing_data/trimmed_reads/*.fna; do
    python /home/knightsd/public/mice5035/NINJA-OPS-1.5.1/bin/ninja.py -i "$file" -o /users/7/wrig1125/preprocessing_data/otus/ninja -p 4 -z -m normal
done

#rename folder for consistency with QIIME commands 
mv /users/7/wrig1125/preprocessing_data/otus/ninja/ninja_otutable.biom /users/7/wrig1125/preprocessing_data/otus/ninja/otutable.biom

#NONE OF THIS IS WORKING HELP 
#text base version of OTU
biom convert -i /users/7/wrig1125/preprocessing_data/otus/ninja/otutable.biom -o /users/7/wrig1125/preprocessing_data/otus/otu_table.txt --to-tsv

head otus/otu_table.txt | cut -f 1-10

#rarefy and filter OTU table
single_rarefaction.py -i otus/ninja/otutable.biom -d 140 -o otus/otu_table_rarefied.biom




